package com.examples.ejb.client;

import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Hashtable;
import java.util.concurrent.Callable;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;

import com.exmaples.ejb.server.EJBServer;

public class EJBClient {

	private static int SPAWN_THREADS = 10;	//number of the parallel calls
	
	public static void main(String args[]) throws NamingException, FileNotFoundException, IOException, InterruptedException {

		System.out.println("EJB client-1");
		// listSystemProperties();
		
		ArrayList<Callable> a = new ArrayList<>();
		
		int i = 0;
		while(i++ < SPAWN_THREADS) {
			Runnable r = new Runnable() {
				
				public void run() {
					// TODO Auto-generated method stub
					try {
						callEJBServer();
					} catch (FileNotFoundException e) {
						// TODO Auto-generated catch block
						e.printStackTrace();
					} catch (NamingException e) {
						// TODO Auto-generated catch block
						e.printStackTrace();
					} catch (IOException e) {
						// TODO Auto-generated catch block
						e.printStackTrace();
					} catch (InterruptedException e) {
						// TODO Auto-generated catch block
						e.printStackTrace();
					}
				}
			};
			System.out.println("oi");
			new Thread(r).start();
			System.out.println("oi");
		}
	}

	public static void callEJBServer() throws NamingException, FileNotFoundException, IOException, InterruptedException {

        final Hashtable<String, String> jndiProperties = new Hashtable<String, String>();
        jndiProperties.put(Context.URL_PKG_PREFIXES, "org.jboss.ejb.client.naming");
        Context context = new InitialContext(jndiProperties);

        EJBServer ejb = (EJBServer) context.lookup("ejb:/ejb-server/EJBServerImpl!com.exmaples.ejb.server.EJBServer");
        System.out.println("Result: " + ejb.execute());

	}
}